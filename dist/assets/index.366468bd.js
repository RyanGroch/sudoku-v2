var D=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var w=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)};var S=(s,e,t)=>(D(s,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();async function y(s){const e=[1,2,3,4,5,6,7,8,9],t=s.boardInput?s.boardInput:[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],i=1,n=1,o=0,r=s.cellClassName?document.querySelectorAll(`.${s.cellClassName}`):null,c=s.solution||null,l=await g(t,i,n,e,o,s.getFirstSolution,r,c);return s.getFirstSolution?t:l}async function g(s,e,t,i,n,o,r,c){let l=n;if(e>9)return l++,l;const h=G(i),f=t>8?e+1:e,m=t>8?1:t+1;if(s[e-1][t-1]){if(l=await g(s,f,m,i,l,o,r,c),o&&l)return l}else{for(const k of h){s[e-1][t-1]=k,r&&await b(r,e-1,t-1,k,c);const R=U(s,e,t);if(J(s,e)||V(s,t)||$(R)){s[e-1][t-1]=0;continue}if(l=await g(s,f,m,i,l,o,r,c),o&&l)return l}s[e-1][t-1]=0,r&&await b(r,e-1,t-1,"",c)}return l}function G(s){const e=s.slice();for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}function J(s,e){const t={},i=s[e-1];for(const n of i){if(t[n])return!0;n!==0&&(t[n]=!0)}return!1}function V(s,e){const t={};for(const i of s){const n=i[e-1];if(t[n])return!0;n!==0&&(t[n]=!0)}return!1}function $(s){const e={};for(const t of s){if(e[t])return!0;t!==0&&(e[t]=!0)}return!1}function U(s,e,t){const i=[],[n,o]=x(e),[r,c]=x(t);for(let l=n;l<o;l++)i.push(...s[l].slice(r,c));return i}function x(s){let e,t;return s>6?(e=6,t=9):s>3?(e=3,t=6):(e=0,t=3),[e,t]}function j(s,e){return s*9+e}function b(s,e,t,i,n){return new Promise(o=>{const r=s[j(e,t)];r.textContent=i,r.classList.add("user-added"),r.classList.remove("notes"),n[e][t]===i?r.classList.remove("wrong"):r.classList.add("wrong"),setTimeout(o,0)})}async function W(s,e){const t={0:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},1:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},2:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},3:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},4:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},5:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},6:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},7:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0},8:{0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0}},i=JSON.parse(JSON.stringify(s));for(;B(i)>e&&Object.keys(t).length!==0;)await F(i,t);return i}function B(s){let e=0;for(const t of s)for(const i of t)i!==0&&e++;return e}async function F(s,e){const t=Object.keys(e),i=t[Math.floor(Math.random()*t.length)],n=Object.keys(e[i]),o=n[Math.floor(Math.random()*n.length)],r=s[i][o];s[i][o]=0,await y({boardInput:s})!==1&&(s[i][o]=r),delete e[i][o],Object.keys(e[i]).length===0&&delete e[i]}var L,M;class H{constructor(){w(this,L)}async initialize(e){this.solution=e.solution||await y({getFirstSolution:!0}),this.difficulty=e.difficulty||"easy",this.minDigits=S(this,L,M).call(this),this.puzzle=e.puzzle||await W(this.solution,this.minDigits),this.board=JSON.parse(JSON.stringify(this.puzzle))}enterInput(e,t,i){this.board[e][t]=Number(i)}canAcceptInput(e,t){return this.puzzle[e][t]===0}erase(e,t){return this.puzzle[e][t]!==0?!1:(this.board[e][t]=0,!0)}isCorrect(e,t,i){return this.solution[e][t]===i}checkIfWin(){return JSON.stringify(this.board)===JSON.stringify(this.solution)}}L=new WeakSet,M=function(){switch(this.difficulty){case"expert":return 25;case"hard":return 30;case"medium":return 35;case"easy":return 40}};const d=document.querySelector(".board"),z=document.querySelector(".select-difficulty"),K=document.querySelectorAll(".difficulty"),v=document.querySelector(".overlay"),Q=document.querySelector(".msg"),C=document.querySelector(".solved-msg"),p=d.childNodes,P=document.querySelectorAll(".number-selection"),X=document.querySelector(".timer-display"),Y=document.querySelector(".pause"),u=document.querySelector(".fa-solid"),Z=document.querySelector(".new-game"),_=document.querySelector(".solve-for-me"),ee=document.querySelector("#undo"),te=document.querySelector("#erase"),I=document.querySelector("#notes"),se=document.querySelector("#hint"),T=document.querySelector("#show-mistakes");class ie{constructor(){this.firstGame=!0,this.notesOn=!1,I.addEventListener("click",this.toggleNotes.bind(this)),T.addEventListener("click",re);for(let e=0;e<81;e++)oe(e);K.forEach(e=>{e.addEventListener("click",async t=>{await N("Please wait while we generate your puzzle..."),await this.gameInit(t),await E(),this.firstGame&&(this.setupEventListeners(),this.firstGame=!1),this.uiLocked=!1})})}async gameInit(e){this.difficulty=e.target.closest(".difficulty").id,this.game=new H,await this.game.initialize({difficulty:this.difficulty}),this.selectedCell=null,this.actionsStack=[],this.timeElapsed=0,this.paused=!1,this.uiLocked=!0,this.solved=!1,p.forEach(t=>{const[i,n]=a(t.id);t.classList.remove("user-added"),t.classList.remove("wrong"),t.classList.remove("selected"),t.classList.remove("same-value"),t.classList.remove("same-group"),this.game.board[i][n]!==0?t.textContent=this.game.board[i][n]:t.textContent=""}),this.clearIntervalId=setInterval(this.clockTick.bind(this),1e3),C.classList.remove("show"),this.solved=!1}resetUI(){this.uiLocked||(this.uiLocked=!0,clearInterval(this.clearIntervalId),u.classList.remove("fa-play"),u.classList.add("fa-pause"),z.classList.remove("hidden"),d.classList.add("hidden"),v.classList.add("hidden"))}setupEventListeners(){p.forEach(e=>{e.addEventListener("click",this.selectCell.bind(this))}),P.forEach(e=>{e.addEventListener("click",this.handleUserInput.bind(this))}),document.addEventListener("keydown",ne),Y.addEventListener("click",this.pauseGame.bind(this)),te.addEventListener("click",this.eraseCell.bind(this)),se.addEventListener("click",this.giveHint.bind(this)),ee.addEventListener("click",this.undoLastAction.bind(this)),Z.addEventListener("click",this.resetUI.bind(this)),_.addEventListener("click",this.solvePuzzle.bind(this))}async solvePuzzle(){if(this.uiLocked||this.paused)return;this.uiLocked=!0;const e=await y({boardInput:JSON.parse(JSON.stringify(this.game.puzzle)),getFirstSolution:!0,cellClassName:"cell",solution:this.game.solution});this.game.board=e,this.handleWinConditions(),this.uiLocked=!1}undoLastAction(){if(this.uiLocked||this.paused||this.actionsStack.length<1)return;const e=this.actionsStack.pop(),t=document.getElementById(e[0]);switch(this.selectedCell!==t&&this.handleCellSelection(t),e[1]){case"replaceValue":if(e[2]){const[o,r]=a(this.selectedCell.id);this.enterAsAnswer(o,r,e[2],!1)}else this.eraseCell();break;case"changeNotesToInput":this.eraseCell();for(const o of e[2])this.handleAsNote(o,!1);break;case"note":this.handleAsNote(e[2],!1);break;case"eraseNotes":for(const o of e[2])this.handleAsNote(o,!1);break;case"eraseNumber":const[i,n]=a(this.selectedCell.id);this.enterAsAnswer(i,n,e[2],!1);break;default:console.log("Error: invalid undo action")}}giveHint(){if(this.uiLocked||this.paused)return;const e=le();if(!e)return;const[t,i]=a(e.id),n=this.game.solution[t][i];this.selectedCell!==e&&this.handleCellSelection(e),this.enterAsAnswer(t,i,n,!0)}toggleNotes(){this.notesOn=!this.notesOn,I.classList.toggle("on")}eraseCell(e){if(this.uiLocked||this.paused||!this.selectedCell)return;const[t,i]=a(this.selectedCell.id);if(!this.game.puzzle[t][i]){if(e){const n=this.selectedCell.classList.contains("notes"),o=n?"eraseNotes":"eraseNumber",r=n?O(this.selectedCell):this.selectedCell.textContent;this.actionsStack.push([this.selectedCell.id,o,r])}this.game.erase(t,i),this.selectedCell.textContent="",this.selectedCell.classList.remove("wrong"),this.selectedCell.classList.remove("user-added"),this.selectedCell.classList.remove("notes"),C.classList.remove("show"),this.solved=!1}}handleUserInput(e){if(this.uiLocked||this.paused||!this.selectedCell)return;const t=e.target.textContent;if(this.notesOn)this.handleAsNote(t,!0);else{const[i,n]=a(this.selectedCell.id);this.enterAsAnswer(i,n,t,!0)}}async handleAsNote(e,t){if(this.selectedCell.textContent&&!this.selectedCell.classList.contains("notes"))return;this.selectedCell.classList.contains("notes")||await ce(this.selectedCell);const i=this.selectedCell.querySelector(`.note-${e}`);i.textContent=i.textContent?"":e,t&&this.actionsStack.push([this.selectedCell.id,"note",e])}enterAsAnswer(e,t,i,n){if(!!this.game.canAcceptInput(e,t)){if(n){const r=this.selectedCell.classList.contains("notes"),c=r?"changeNotesToInput":"replaceValue",l=r?O(this.selectedCell):this.selectedCell.textContent;this.actionsStack.push([this.selectedCell.id,c,l])}this.game.enterInput(e,t,i),this.selectedCell.classList.remove("notes"),this.selectedCell.textContent=this.game.board[e][t]||"",this.selectedCell.classList.add("user-added"),this.game.isCorrect(e,t,this.game.board[e][t])?(this.selectedCell.classList.remove("wrong"),this.handleWinConditions()):(this.selectedCell.classList.add("wrong"),C.classList.remove("show"),this.solved=!1)}}selectCell(e){const t=e.target.closest(".cell");this.handleCellSelection(t)}handleCellSelection(e){const t=this.selectedCell===e;this.selectedCell=e;const i=this.selectedCell.id,[n,o]=a(i),r=A(n,o),c=e.textContent;p.forEach(l=>{const[h,f]=a(l.id),m=A(h,f);l.classList.remove("selected"),l.classList.remove("same-value"),l.classList.remove("same-group"),t||(l.id===i?l.classList.add("selected"):l.textContent&&l.textContent===c&&!l.classList.contains("notes")&&!this.selectedCell.classList.contains("notes")?l.classList.add("same-value"):(h===n||f===o||m===r)&&l.classList.add("same-group"))}),t&&(this.selectedCell=null)}clockTick(){this.timeElapsed+=1;const e=Math.floor(this.timeElapsed/3600),t=Math.floor(this.timeElapsed/60-60*e),i=Math.floor(this.timeElapsed-60*t-3600*e);X.textContent=`${e?e+":":""}${t}:${i<10?"0":""}${i}`}pauseGame(){this.uiLocked||(this.paused?(this.solved||(this.clearIntervalId=setInterval(this.clockTick.bind(this),1e3)),u.classList.remove("fa-play"),u.classList.add("fa-pause"),E()):(clearInterval(this.clearIntervalId),u.classList.remove("fa-pause"),u.classList.add("fa-play"),N("Paused")),this.paused=!this.paused)}handleWinConditions(){this.game.checkIfWin()&&(C.classList.add("show"),this.solved=!0,clearInterval(this.clearIntervalId))}}function N(s){return new Promise(e=>{z.classList.add("hidden"),d.classList.add("hidden"),v.classList.remove("hidden"),Q.textContent=s,setTimeout(e,0)})}function E(){return new Promise(s=>{d.classList.remove("hidden"),v.classList.add("hidden"),setTimeout(s,0)})}function ne(s){const e=String.fromCharCode(s.keyCode);e>=1&&e<=9&&P[e-1].click()}function A(s,e){let t=0;return t+=s>=6?2:s>=3&&s<6?1:0,t+=e>=6?6:e>=3&&e<6?3:0,t}function oe(s){const[e,t]=a(s),i=document.createElement("div");i.classList.add("cell"),i.setAttribute("id",s),q(i,e,["xx-top","x-top","x-bottom","xx-bottom"]),q(i,t,["xx-left","x-left","x-right","xx-right"]),d.appendChild(i)}function q(s,e,t){switch(e){case 0:s.classList.add(t[0]);break;case 3:case 6:s.classList.add(t[1]);break;case 2:case 5:s.classList.add(t[2]);break;case 8:s.classList.add(t[3]);break}}function re(){d.classList.toggle("show-mistakes"),T.classList.toggle("on")}function le(){const s=[];return p.forEach(e=>{(!e.textContent||e.classList.contains("notes"))&&s.push(e)}),s.length>0?s[Math.floor(Math.random()*s.length)]:null}function O(s){const e=[],t=s.querySelectorAll(".note");for(const i of t)i.textContent&&e.push(i.textContent);return e}function ce(s){return new Promise(e=>{s.classList.add("notes");for(let t=1;t<=9;t++){const i=document.createElement("span");i.classList.add("note"),i.classList.add(`note-${t}`),s.appendChild(i)}setTimeout(e,0)})}function a(s){return[Math.floor(s/9),s%9]}new ie;
